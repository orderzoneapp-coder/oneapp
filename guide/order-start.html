<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>오더즈 주문 가이드</title>
    <!-- 카카오톡 등 SNS 공유 시 보여지는 미리보기 정보(Open Graph) -->
    <meta property="og:title" content="오더즈 주문 가이드">
    <meta property="og:description" content="터치 몇 번이면 발주 끝! 세상에서 가장 쉬운 주문 방법">
    <!-- 오더즈 슬로건 실제 이미지 주소 반영 -->
    <meta property="og:image" content="https://oneapp2.godohosting.com/order_guide/slogan.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        /* 카카오톡 등 인앱 브라우저 스크롤 및 하단 잘림 완벽 방지 */
        html, body {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            overscroll-behavior: none;
            font-family: 'Pretendard', sans-serif;
            background-color: #e5e7eb;
            display: flex;
            justify-content: center;
        }
        
        .app-container {
            width: 100%;
            max-width: 400px;
            height: 100%;
            background-color: #ffffff;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- 앱 화면 슬라이드 애니메이션 처리 --- */
        #screen-home, #screen-order {
            transition: transform 0.45s cubic-bezier(0.25, 1, 0.5, 1);
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        #screen-order {
            transform: translateX(100%);
        }
        #app.show-order #screen-home {
            transform: translateX(-100%);
        }
        #app.show-order #screen-order {
            transform: translateX(0);
        }

        .scroll-area::-webkit-scrollbar {
            display: none;
        }

        /* 툴팁 기본 배경색 동적 제어를 위한 CSS 변수 세팅 */
        :root {
            --tooltip-bg: #10b981;
        }

        .pulse-border {
            box-shadow: 0 0 0 0 var(--tooltip-bg);
            animation: pulse-ring 1.5s infinite;
        }

        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 var(--tooltip-bg); }
            70% { box-shadow: 0 0 0 8px rgba(0,0,0,0); }
            100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); }
        }

        /* 화살표 꼬리 위치를 변수로 동적 제어 */
        .tooltip-arrow-top::before {
            content: '';
            position: absolute;
            top: -8px;
            left: var(--arrow-pos, 50%);
            transform: translateX(-50%);
            border-width: 0 8px 8px 8px;
            border-color: transparent transparent var(--tooltip-bg) transparent;
        }
        .tooltip-arrow-bottom::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: var(--arrow-pos, 50%);
            transform: translateX(-50%);
            border-width: 8px 8px 0 8px;
            border-color: var(--tooltip-bg) transparent transparent transparent;
        }
        
        /* 툴팁 및 보조박스 컨테이너 애니메이션 */
        #tooltip {
            position: absolute;
            z-index: 70;
            width: 295px; 
            background-color: var(--tooltip-bg);
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.25s ease-in-out;
        }
        #extra-boxes-container {
            transition: opacity 0.2s ease-in-out;
        }

        /* 도입 팝업 부드러운 슬라이드업 */
        @keyframes slideUpPopup {
            0% { opacity: 0; transform: translateY(30px) scale(0.95); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-popup {
            animation: slideUpPopup 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* 내용 페이드 애니메이션 */
        @keyframes contentFade {
            0% { opacity: 0; transform: translateY(4px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .animate-content {
            animation: contentFade 0.4s ease-out forwards;
        }
    </style>
</head>
<body>

    <div class="app-container" id="app">
        
        <!-- ========================================== -->
        <!-- [화면 1] 홈/상품목록 -->
        <!-- ========================================== -->
        <div id="screen-home" class="flex flex-col h-full w-full absolute inset-0 bg-white">
            <header class="flex justify-between items-center px-3 py-2.5 border-b relative h-12">
                <div class="flex items-center gap-2 z-10 w-20">
                    <i class="fas fa-bars text-lg"></i>
                    <span class="font-bold text-sm">상품목록</span>
                </div>
                <h1 class="text-[#008c45] text-xl font-black tracking-tighter absolute left-1/2 transform -translate-x-1/2">NH라인</h1>
                <div class="text-xs font-bold z-10 w-20 text-right">0P <i class="fas fa-user ml-1"></i></div>
            </header>

            <div id="target-category" class="flex justify-between py-2 px-2 border-b text-[10px] text-center text-gray-600 bg-white relative">
                <div class="flex-1 flex flex-col items-center justify-center">
                    <div class="h-[20px] flex items-center justify-center mb-1"><i class="fas fa-carrot text-[16px] text-gray-400"></i></div>
                    <span>채소/과일</span>
                </div>
                <div class="flex-1 flex flex-col items-center justify-center">
                    <div class="h-[20px] flex items-center justify-center mb-1"><i class="fas fa-fish text-[16px] text-gray-400"></i></div>
                    <span>수산/축산</span>
                </div>
                <div class="flex-1 flex flex-col items-center justify-center">
                    <div class="h-[20px] flex items-center justify-center mb-1"><i class="fas fa-snowflake text-[16px] text-gray-400"></i></div>
                    <span>식품/가공</span>
                </div>
                <div class="flex-1 flex flex-col items-center justify-center">
                    <div class="h-[20px] flex items-center justify-center mb-1">
                        <svg viewBox="0 0 24 24" class="w-[16px] h-[16px] fill-current text-gray-400">
                            <path d="M12.5 2h-1c-.3 0-.5.2-.5.5v2.6c-1.4.3-2.5 1.5-2.5 3v11.4c0 1.4 1.1 2.5 2.5 2.5h2c1.4 0 2.5-1.1 2.5-2.5V8.1c0-1.5-1.1-2.7-2.5-3V2.5c0-.3-.2-.5-.5-.5zM11 5h2v2h-2V5zm3 14.5c0 .3-.2.5-.5.5h-3c-.3 0-.5-.2-.5-.5v-11c0-.3.2-.5.5-.5h3c.3 0 .5.2.5.5v11z"/>
                        </svg>
                    </div>
                    <span>양념/소스</span>
                </div>
                <div class="flex-1 flex flex-col items-center justify-center">
                    <div class="h-[20px] flex items-center justify-center mb-1"><i class="fas fa-utensils text-[16px] text-gray-400"></i></div>
                    <span>주방/잡화</span>
                </div>
            </div>

            <div class="flex text-center border-b font-bold text-[13px]">
                <div class="w-1/2 py-2 text-[#008c45] border-b-2 border-[#008c45]">오늘의행사</div>
                <div class="w-1/2 py-2 text-gray-400">매장행사</div>
            </div>

            <div class="flex-1 overflow-y-auto scroll-area pb-16">
                <div class="flex items-center p-3 border-b relative">
                    <div class="w-14 h-14 bg-gray-100 rounded flex-shrink-0 flex items-center justify-center overflow-hidden">
                        <img src="https://placehold.co/100x100/e2e8f0/94a3b8?text=무" class="w-full h-full object-cover">
                    </div>
                    <div class="ml-3 flex-1">
                        <h3 class="font-bold text-gray-800 text-[15px]">월동무(특) <span class="text-gray-400 text-[11px] font-normal">BOX</span></h3>
                        <p class="text-[#008c45] font-bold text-[17px] mt-0.5">21,000원</p>
                    </div>
                    <div id="target-checkbox" class="w-[26px] h-[26px] flex items-center justify-center ml-2 transition-transform">
                        <img src="https://oneapp2.godohosting.com/order_guide/%EC%B2%B4%ED%81%AC%EC%A0%84.png" alt="체크 전" class="w-full h-full object-contain">
                    </div>
                </div>
            </div>

            <div class="h-14 border-t bg-white flex items-center w-full absolute bottom-0 z-10 px-1">
                <div id="target-search-icon" class="flex-1 flex flex-col items-center justify-center text-gray-500 h-full relative">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="w-[20px] h-[20px] mb-0.5 text-gray-600">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                    </svg>
                    <span class="text-[9px] font-medium text-gray-600">검색</span>
                </div>
                <div class="w-[200px] flex justify-center relative">
                    <button id="target-order-btn" class="w-full border border-gray-200 rounded-xl py-1 flex flex-col items-center justify-center bg-white shadow-md transition-all">
                        <span class="text-[#008c45] text-[8px] font-bold tracking-widest leading-tight">ORDERZ</span>
                        <span class="font-bold text-gray-800 text-[15px]">주문하러 가기</span>
                    </button>
                </div>
                <div class="flex-1 flex flex-col items-center justify-center text-gray-500 h-full">
                    <i class="far fa-comment-dots text-lg mb-0.5 text-gray-600"></i>
                    <span class="text-[9px] font-medium text-gray-600">문의</span>
                </div>
            </div>
        </div>

        <!-- ========================================== -->
        <!-- [화면 2] 빠른주문 -->
        <!-- ========================================== -->
        <div id="screen-order" class="flex flex-col h-full w-full absolute inset-0 bg-white z-[5]">
            <header class="flex justify-between items-center px-3 py-2.5 border-b relative h-12">
                <div class="flex items-center gap-2 z-10 w-20">
                    <i class="fas fa-bars text-lg"></i>
                    <span class="font-bold text-sm">빠른주문</span>
                </div>
                <h1 class="text-[#008c45] text-xl font-black tracking-tighter absolute left-1/2 transform -translate-x-1/2">NH라인</h1>
                <div class="text-xs font-bold z-10 w-20 text-right">0P <i class="fas fa-user ml-1"></i></div>
            </header>

            <div class="flex items-center border-b border-gray-200 px-2 text-[13px] text-gray-500 font-bold bg-white">
                <div class="flex-1 text-center py-2.5 text-gray-600"><i class="fas fa-star text-yellow-400 mr-1 text-[11px]"></i>단골특가</div>
                <div class="flex-1 text-center py-2.5 text-[#008c45] border-b-2 border-[#008c45] -mb-[1px] relative z-10">LIST</div>
                <div class="flex-1 text-center py-2.5 text-gray-300">MY1</div>
                <div class="flex-1 text-center py-2.5 text-gray-300">MY2</div>
                <div class="px-2 py-2.5 text-gray-500"><i class="fas fa-sliders-h text-base"></i></div>
            </div>

            <div class="flex-1 overflow-y-auto scroll-area pb-16">
                <div class="flex items-center p-3 border-b relative">
                    <img src="https://placehold.co/60x60/e2e8f0/94a3b8?text=무" class="w-10 h-10 rounded object-cover">
                    <div class="ml-3 flex-1">
                        <h3 class="font-bold text-gray-800 text-[14px]">무우(낱개)</h3>
                        <p class="text-[#008c45] text-[14px] mt-0.5">2,700원</p>
                    </div>
                    <div id="target-qty" class="flex items-center border border-gray-200 rounded-lg bg-gray-50 h-7">
                        <button class="w-7 h-7 flex items-center justify-center text-gray-400 font-bold"><i class="fas fa-minus text-[10px]"></i></button>
                        <div class="w-7 text-center font-bold text-[15px] bg-white h-7 flex items-center justify-center border-x border-gray-200">0</div>
                        <button class="w-7 h-7 flex items-center justify-center text-gray-400 font-bold"><i class="fas fa-plus text-[10px]"></i></button>
                    </div>
                </div>
            </div>

            <div class="h-14 border-t bg-white flex items-center w-full absolute bottom-0 z-10 px-1">
                <div class="flex-1 flex flex-col items-center justify-center text-gray-500 h-full">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="w-[20px] h-[20px] mb-0.5 text-gray-600">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                    </svg>
                    <span class="text-[9px] font-medium text-gray-600">검색</span>
                </div>
                <div id="target-submit-btn" class="w-[200px] flex justify-center relative">
                    <button id="final-order-btn" class="w-full border border-gray-200 rounded-xl py-1 flex flex-col items-center justify-center bg-white shadow-md">
                        <span class="text-[#008c45] text-[8px] font-bold tracking-widest leading-tight">ORDERZ</span>
                        <span class="font-bold text-gray-800 text-[15px]">상품을 담아주세요</span>
                    </button>
                </div>
                <div class="flex-1 flex flex-col items-center justify-center text-gray-500 h-full">
                    <i class="far fa-comment-dots text-lg mb-0.5 text-gray-600"></i>
                    <span class="text-[9px] font-medium text-gray-600">문의</span>
                </div>
            </div>
        </div>

        <!-- 도입 팝업 -->
        <div id="intro-popup-overlay" class="absolute inset-0 bg-black/60 z-[100] flex items-center justify-center backdrop-blur-sm transition-opacity duration-300" style="display: none;">
            <div class="bg-white rounded-3xl p-6 w-[85%] max-w-[320px] shadow-2xl text-center animate-popup opacity-0">
                <div class="flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-bolt text-[50px] text-yellow-400 drop-shadow-md"></i>
                </div>
                <h2 class="text-[24px] font-black text-gray-800 mb-6 leading-snug tracking-tighter italic transform -skew-x-6">
                    순식간에 끝나는 주문!
                </h2>
                <button onclick="startGuideFromPopup()" class="w-full bg-[#10b981] text-white font-black py-3.5 rounded-xl shadow-md text-[16px] transition-colors">
                    바로 시작하기
                </button>
            </div>
        </div>

        <!-- 가이드 오버레이 -->
        <div id="overlay-container" class="absolute inset-0 z-50 overflow-hidden" style="display: none;">
            <svg width="100%" height="100%" class="absolute inset-0 pointer-events-none z-10">
                <defs>
                    <mask id="hole-mask">
                        <rect width="100%" height="100%" fill="white" />
                        <g id="mask-holes"></g>
                    </mask>
                </defs>
                <rect width="100%" height="100%" fill="rgba(0,0,0,0.65)" mask="url(#hole-mask)" />
            </svg>
            
            <div id="spotlight-borders" class="absolute inset-0 pointer-events-none z-20"></div>
            
            <div id="extra-boxes-container" class="absolute inset-0 pointer-events-none z-[60]"></div>
            
            <div id="tooltip" class="text-white rounded-xl shadow-2xl p-4 flex flex-col z-30">
                <div class="flex items-start mb-2.5">
                    <span id="tooltip-step" class="bg-white text-[#10b981] text-[11px] font-black px-2.5 py-0.5 rounded-full shadow-sm">STEP 1</span>
                </div>
                
                <div id="tooltip-text-wrapper">
                    <h3 id="tooltip-title" class="flex justify-between items-center font-bold text-[22px] mb-1 tracking-tight leading-tight"></h3>
                    <!-- 서브 텍스트 크기를 text-[15.5px]로 2px 키움 -->
                    <p id="tooltip-desc" class="text-[15.5px] opacity-95 leading-relaxed break-keep"></p>
                </div>
                
                <div class="flex justify-between items-center mt-4 pt-3 border-t border-white/20">
                    <div id="step-dots" class="flex gap-1.5"></div>
                    <button id="next-btn" onclick="nextStep()" class="bg-white text-[#10b981] font-bold px-4 py-2 rounded-lg text-[13px] shadow-md transition-colors duration-300">
                        다음 <i class="fas fa-chevron-right ml-1"></i>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const guideSteps = [
            {
                targetIds: ['target-category', 'target-search-icon'],
                screen: 'home',
                title: '<span>자주 쓰는 상품 찾기</span>',
                desc: '<b>1, 2번</b> 편하신 방식으로<br>원하는 상품을 찾아보세요.',
                tooltipPosition: 'center',
                theme: '#10b981',
                extraBoxes: [
                    { targetId: 'target-category', text: '<span class="bg-[#10b981] w-5 h-5 rounded-full flex items-center justify-center mr-1.5 text-white text-[12px]">1</span> 카테고리로 찾기', pos: 'bottom' },
                    { targetId: 'target-search-icon', text: '<span class="bg-[#10b981] w-5 h-5 rounded-full flex items-center justify-center mr-1.5 text-white text-[12px]">2</span> 직접 검색하기', pos: 'top' }
                ]
            },
            {
                targetIds: ['target-checkbox'],
                screen: 'home',
                title: '<span>상품 클릭하기</span>',
                desc: "자주 구매하는 상품은 <b>우측 체크박스[<i class='fas fa-check'></i>]로 클릭!</b><br>매번 찾을 필요 없이 한곳에 모아드려요.",
                tooltipPosition: 'bottom',
                theme: '#10b981',
                action: () => {
                    const imgEl = document.querySelector('#target-checkbox img');
                    if(imgEl) {
                        imgEl.src = 'https://oneapp2.godohosting.com/order_guide/%EC%B2%B4%ED%81%AC%ED%9B%84.png';
                        imgEl.alt = '체크 후';
                    }
                }
            },
            {
                targetIds: ['target-order-btn'],
                screen: 'home',
                title: '<span>주문 페이지로 이동</span>',
                desc: '상품을 모두 담았다면,<br>하단의 <b>[주문하러 가기]</b>를 통해 주문 페이지로 이동합니다.',
                tooltipPosition: 'top',
                theme: '#10b981'
            },
            {
                targetIds: ['target-qty'],
                screen: 'order',
                title: '<span>필요한 만큼 수량 조절</span>',
                desc: '체크한 상품들이 모두 모여있어요.<br><b>숫자를 직접 입력</b>하거나 <b>[-+]버튼</b>으로 쉽게 조절할 수 있어요.',
                tooltipPosition: 'bottom',
                theme: '#10b981',
                action: () => {
                    const el = document.getElementById('target-qty').querySelector('div');
                    el.innerText = '1';
                    const btn = document.getElementById('final-order-btn');
                    btn.className = "w-full border border-[#A5D6B4] rounded-xl py-1 flex flex-col items-center justify-center bg-[#A5D6B4] shadow-md transition-all duration-300";
                    btn.innerHTML = `
                        <span class="text-[#005a2b] text-[8px] font-bold tracking-widest leading-tight opacity-80">ORDERZ</span>
                        <div class="flex items-center justify-center gap-1.5 mt-[1px]">
                            <span class="bg-[#ff9f72] text-white text-[9px] font-bold w-3.5 h-3.5 rounded-full flex items-center justify-center leading-none pt-px">1</span>
                            <span class="font-bold text-[#1a4a2e] text-[16px]">담은 상품 확인하기</span>
                        </div>
                    `;
                }
            },
            {
                targetIds: ['target-submit-btn'],
                screen: 'order',
                title: '<span>주문 완료하기</span>',
                desc: '수량 조절이 끝났다면,<br><b>최종 주문 상품을 확인하고 주문을 완료해보세요!</b>',
                tooltipPosition: 'top',
                theme: '#10b981'
            }
        ];

        let currentStep = 0;

        function renderDots(activeIndex) {
            const stepDots = document.getElementById('step-dots');
            stepDots.innerHTML = '';
            guideSteps.forEach((_, i) => {
                const opacity = i === activeIndex ? 'bg-white' : 'bg-white/30';
                stepDots.innerHTML += `<div class="w-1.5 h-1.5 rounded-full ${opacity} transition-colors"></div>`;
            });
        }

        function showStep(index) {
            const step = guideSteps[index];
            const app = document.getElementById('app');
            const tooltip = document.getElementById('tooltip');
            const extraContainer = document.getElementById('extra-boxes-container');
            const maskHoles = document.getElementById('mask-holes');
            const spotlightBorders = document.getElementById('spotlight-borders');
            
            tooltip.style.opacity = '0';
            extraContainer.style.opacity = '0';
            
            let delay = 250;

            const isScreenChanging = (step.screen === 'order' && !app.classList.contains('show-order')) || 
                                     (step.screen === 'home' && app.classList.contains('show-order'));

            if (isScreenChanging) {
                maskHoles.innerHTML = '';
                spotlightBorders.innerHTML = '';
                if (step.screen === 'order') { app.classList.add('show-order'); } 
                else { app.classList.remove('show-order'); }
                delay = 550; 
            }

            setTimeout(() => {
                maskHoles.innerHTML = '';
                spotlightBorders.innerHTML = '';
                extraContainer.innerHTML = '';
                extraContainer.style.opacity = '1';

                const appRect = app.getBoundingClientRect();
                document.documentElement.style.setProperty('--tooltip-bg', step.theme || '#10b981');
                
                let lastRect = null;

                step.targetIds.forEach(targetId => {
                    const target = document.getElementById(targetId);
                    if (!target) return;
                    
                    const rect = target.getBoundingClientRect();
                    const pad = 2; 
                    let top = rect.top - appRect.top - pad;
                    let left = rect.left - appRect.left - pad;
                    let width = rect.width + (pad * 2);
                    let height = rect.height + (pad * 2);

                    const edgeMargin = 2;
                    if (top < edgeMargin) { height -= (edgeMargin - top); top = edgeMargin; }
                    if (left < edgeMargin) { width -= (edgeMargin - left); left = edgeMargin; }
                    if (top + height > appRect.height - edgeMargin) { height = appRect.height - edgeMargin - top; }
                    if (left + width > appRect.width - edgeMargin) { width = appRect.width - edgeMargin - left; }

                    maskHoles.innerHTML += `<rect x="${left}" y="${top}" width="${width}" height="${height}" rx="6" fill="black" />`;
                    spotlightBorders.innerHTML += `<div class="absolute border-2 rounded-md pulse-border" style="border-color: var(--tooltip-bg); top:${top}px; left:${left}px; width:${width}px; height:${height}px;"></div>`;
                    
                    lastRect = { top, left, width, height, rect };
                });

                if (step.extraBoxes) {
                    step.extraBoxes.forEach(box => {
                        const target = document.getElementById(box.targetId);
                        if (!target) return;
                        const rect = target.getBoundingClientRect();
                        const div = document.createElement('div');
                        div.className = `absolute bg-white text-gray-800 text-[15px] font-extrabold px-3.5 py-2 rounded-lg shadow-[0_4px_16px_rgba(0,0,0,0.25)] whitespace-nowrap flex items-center z-[60] opacity-0 translate-y-2 transition-all duration-500 ease-out`;
                        div.innerHTML = box.text;
                        extraContainer.appendChild(div);

                        requestAnimationFrame(() => {
                            const boxRect = div.getBoundingClientRect();
                            let top = 0;
                            let left = rect.left - appRect.left + (rect.width / 2) - (boxRect.width / 2);

                            if (box.pos === 'bottom') {
                                top = rect.bottom - appRect.top + 12;
                                div.innerHTML += '<div class="absolute -top-[5px] left-1/2 transform -translate-x-1/2 border-l-[6px] border-r-[6px] border-b-[6px] border-transparent border-b-white"></div>';
                            } else if (box.pos === 'top') {
                                top = rect.top - appRect.top - boxRect.height - 12;
                                div.innerHTML += '<div class="absolute -bottom-[5px] left-1/2 transform -translate-x-1/2 border-l-[6px] border-r-[6px] border-t-[6px] border-transparent border-t-white"></div>';
                            }
                            
                            if (left < 10) left = 10;
                            if (left + boxRect.width > appRect.width - 10) left = appRect.width - boxRect.width - 10;

                            div.style.top = `${top}px`;
                            div.style.left = `${left}px`;
                            setTimeout(() => {
                                div.classList.remove('opacity-0', 'translate-y-2');
                                div.classList.add('opacity-100', 'translate-y-0');
                            }, 50);
                        });
                    });
                }

                document.getElementById('tooltip-step').innerText = `STEP ${index + 1}`;
                document.getElementById('tooltip-title').innerHTML = step.title; 
                document.getElementById('tooltip-desc').innerHTML = step.desc;

                renderDots(index);

                const nextBtn = document.getElementById('next-btn');
                if (index === guideSteps.length - 1) { nextBtn.innerHTML = '시작하기'; } 
                else if (index === 2) { nextBtn.innerHTML = '주문 이동 <i class="fas fa-chevron-right ml-1"></i>'; } 
                else { nextBtn.innerHTML = '다음 <i class="fas fa-chevron-right ml-1"></i>'; }

                tooltip.style.visibility = 'visible';
                tooltip.classList.remove('tooltip-arrow-top', 'tooltip-arrow-bottom');

                if (step.tooltipPosition === 'center') {
                    tooltip.style.top = '50%';
                    tooltip.style.left = '50%';
                    tooltip.style.transform = 'translate(-50%, -50%)';
                } else {
                    tooltip.style.transform = 'none';
                    if (step.tooltipPosition === 'bottom') {
                        tooltip.style.top = `${lastRect.rect.bottom - appRect.top + 15}px`;
                        tooltip.classList.add('tooltip-arrow-top');
                    } else {
                        const tooltipHeight = tooltip.offsetHeight || 150;
                        tooltip.style.top = `${lastRect.rect.top - appRect.top - tooltipHeight - 15}px`;
                        tooltip.classList.add('tooltip-arrow-bottom');
                    }
                    let tLeft = (lastRect.rect.left - appRect.left + lastRect.rect.width / 2) - 147.5; 
                    if (tLeft < 10) tLeft = 10;
                    if (tLeft + 295 > appRect.width - 10) tLeft = appRect.width - 305;
                    tooltip.style.left = `${tLeft}px`;
                    let arrowPos = (lastRect.rect.left - appRect.left + lastRect.rect.width / 2) - tLeft;
                    arrowPos = Math.max(16, Math.min(arrowPos, 295 - 16));
                    tooltip.style.setProperty('--arrow-pos', `${arrowPos}px`);
                }
                tooltip.style.opacity = '1';
            }, delay);
        }

        function nextStep() {
            if (guideSteps[currentStep].action) { guideSteps[currentStep].action(); }
            if (currentStep < guideSteps.length - 1) {
                currentStep++;
                showStep(currentStep);
            } else { endGuide(); }
        }

        function startGuideFromPopup() {
            document.getElementById('intro-popup-overlay').style.display = 'none';
            document.getElementById('overlay-container').style.display = 'block';
            showStep(0);
        }

        function endGuide() {
            document.getElementById('overlay-container').style.display = 'none';
            // 가이드 종료 후 오더즈 홈페이지로 이동
            window.location.href = 'https://orderz.kr/';
        }

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('intro-popup-overlay').style.display = 'flex';
            }, 500);
        };
    </script>
</body>
</html>
