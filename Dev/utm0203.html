<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <title>ì˜¤ë”ì¦ˆ ë§í¬ ê´€ë¦¬ì (v8.3 - Layout Updated)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f4f7fa; color: #334155; min-width: 1024px; }
        
        /* [Select Design] */
        select.input-base {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.2em 1.2em;
            padding-right: 2rem;
        }
        select optgroup { font-weight: 800; color: #1e40af; background-color: #eff6ff; padding: 8px 0; font-family: 'Noto Sans KR', sans-serif; }
        select option { font-weight: 400; color: #334155; background-color: #fff; padding: 8px 10px; font-size: 13px; }

        /* [Layout] */
        .tbl_frm { border-collapse: separate; border-spacing: 0; width: 100%; }
        .tbl_frm th { background-color: #f8fafc; padding: 14px 16px; text-align: left; font-weight: 600; font-size: 13px; border-bottom: 1px solid #e2e8f0; color: #475569; width: 150px; border-right: 1px solid #e2e8f0; vertical-align: top; }
        .tbl_frm td { padding: 14px 16px; border-bottom: 1px solid #e2e8f0; background-color: #fff; vertical-align: top; }
        
        /* [List Table] */
        .tbl_head_container { background-color: #fff; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid #e2e8f0; }
        .tbl_head { border-collapse: collapse; width: 100%; table-layout: fixed; }
        .tbl_head th { background-color: #f8fafc; padding: 12px 14px; font-weight: 700; font-size: 12px; border-bottom: 1px solid #e2e8f0; color: #64748b; vertical-align: middle; }
        .tbl_head td { padding: 12px 14px; border-bottom: 1px solid #e2e8f0; font-size: 12px; color: #334155; vertical-align: middle; }
        
        /* Inputs & Controls */
        .input-base { width: 100%; border: 1px solid #cbd5e1; border-radius: 4px; padding: 8px 10px; font-size: 13px; outline: none; transition: border 0.2s; height: 36px; }
        .input-base:focus { border-color: #3b82f6; }
        .input-required { background-color: #f8fafc; border-color: #cbd5e1; }
        .input-required:focus { background-color: #fff; border-color: #3b82f6; }
        
        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #3b82f6; }
        .toggle-checkbox:checked + .toggle-label { background-color: #3b82f6; }
        .toggle-label { width: 34px; height: 18px; } 
        .toggle-checkbox { width: 14px; height: 14px; top: 2px; } 
        .toggle-checkbox:checked { transform: translateX(100%); right: auto; left: 2px; }
        
        /* Badges */
        .preset-badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; background-color: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; }
        .medium-badge { font-size: 9px; color: #94a3b8; margin-left: 4px; font-weight: 400; }
        .expired-badge { font-size: 10px; color: #ef4444; background-color: #fef2f2; border: 1px solid #fee2e2; padding: 2px 6px; border-radius: 4px; font-weight: 700; display: inline-block; margin-top: 4px; }
        .off-badge { font-size: 10px; color: #64748b; background-color: #f1f5f9; border: 1px solid #e2e8f0; padding: 2px 8px; border-radius: 4px; font-weight: 700; display: inline-block; margin-top: 4px; letter-spacing: 0.5px; }

        /* [Link Styling] */
        .url-text { font-family: 'JetBrains Mono', monospace; font-size: 11px; line-height: 1.5; }
        .url-text-target { word-break: break-all; white-space: normal; color: #64748b; margin-top: 4px; display: block; }
        .url-base { color: #334155; font-weight: 600; }
        .url-params { color: #94a3b8; }
        
        .copy-btn-wrapper { display: flex; align-items: center; justify-content: center; height: 100%; }
        .btn-copy-circle { 
            width: 32px; height: 32px; border-radius: 50%; border: 1px solid #e2e8f0; 
            display: flex; align-items: center; justify-content: center; 
            color: #64748b; background-color: #fff; cursor: pointer; transition: all 0.2s; 
        }
        .btn-copy-circle:hover { border-color: #3b82f6; color: #2563eb; background-color: #eff6ff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }

        /* [UX] Toast Notification */
        #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 100; visibility: hidden; opacity: 0; transition: opacity 0.3s, bottom 0.3s; }
        #toast-container.show { visibility: visible; opacity: 1; bottom: 40px; }
        .toast-message { background-color: #1e293b; color: #fff; padding: 10px 20px; border-radius: 50px; font-size: 13px; font-weight: 500; box-shadow: 0 4px 15px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 8px; }
    </style>
</head>
<body>
    <header class="bg-white border-b border-slate-200 px-6 py-3 mb-5 shadow-sm sticky top-0 z-50">
        <div class="flex justify-between items-center max-w-7xl mx-auto w-full">
            <h1 class="text-lg font-bold text-slate-800"><i class="fas fa-link text-blue-600 mr-2"></i>ë§ˆì¼€íŒ… ë§í¬ ê´€ë¦¬ì <span class="text-xs font-normal text-slate-400 ml-1">v8.3 (Layout Updated)</span></h1>
            <div class="text-xs text-slate-500 bg-slate-100 px-3 py-1 rounded-full">
                <i class="fas fa-check-circle mr-1 text-green-500"></i> MVP ê·œì¹™ ì¤€ìˆ˜: í•„ìˆ˜ í•­ëª© ì¢Œì¸¡ ë°°ì¹˜ ì™„ë£Œ
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-6 pb-20">
        
        <!-- ë§í¬ ìƒì„± -->
        <section class="mb-8">
            <div class="flex items-center gap-2 mb-2 border-l-4 border-blue-600 pl-3">
                <h2 class="text-sm font-bold text-slate-700">ì‹ ê·œ ìº í˜ì¸ ìƒì„±</h2>
            </div>
            
            <div class="bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden">
                <table class="tbl_frm">
                    <tbody>
                        <!-- STEP 1 -->
                        <tr>
                            <th>
                                <div class="flex flex-col gap-0.5 items-center">
                                    <span class="bg-blue-600 text-white w-4 h-4 flex items-center justify-center rounded-full text-[9px] mb-0.5">1</span>
                                    <span>ìº í˜ì¸ ì •ë³´</span>
                                </div>
                            </th>
                            <td colspan="3">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-[11px] font-bold text-blue-800 mb-1">ìº í˜ì¸ ëª… (Memo) *</label>
                                        <input type="text" id="in_memo" class="input-base input-required" placeholder="ì˜ˆ: 26ë…„ ì„¤ë‚  ê°ì‚¬ ì´ë²¤íŠ¸">
                                    </div>
                                    <div>
                                        <label class="block text-[11px] font-bold text-slate-600 mb-1">ë‹´ë‹¹ ìœ í†µì‚¬ (yt_code)</label>
                                        <input type="text" id="in_yt" class="input-base" placeholder="HQ (ê¸°ë³¸ê°’)">
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- STEP 2 -->
                        <tr>
                            <th>
                                <div class="flex flex-col gap-0.5 items-center">
                                    <span class="bg-slate-500 text-white w-4 h-4 flex items-center justify-center rounded-full text-[9px] mb-0.5">2</span>
                                    <span>ì—°ê²° ì„¤ì •</span>
                                </div>
                            </th>
                            <td colspan="3">
                                <div class="grid grid-cols-2 gap-4">
                                    <!-- [Left] Landing Page (Base URL) -->
                                    <div>
                                        <label class="block text-[11px] font-bold text-slate-700 mb-1">ëœë”©í˜ì´ì§€ (Base URL) *</label>
                                        <input type="text" id="in_url" class="input-base input-required" placeholder="https://orderz.kr/member/join.php">
                                    </div>
                                    <!-- [Right] Channel Preset -->
                                    <div>
                                        <label class="block text-[11px] font-bold text-slate-600 mb-1">ì±„ë„ í”„ë¦¬ì…‹ (GA4 Source/Medium) *</label>
                                        <select id="in_channel" class="input-base input-required">
                                            <optgroup label="âœ… 1. Owned / Organic (ë¹„ìš© ì—†ìŒ)">
                                                <option value="orderz|referral">ì˜¤ë”ì¦ˆ (orderz / referral)</option>
                                                <option value="blog|referral">ë¸”ë¡œê·¸ (blog / referral)</option>
                                                <option value="place|referral">í”Œë ˆì´ìŠ¤ (place / referral)</option>
                                                <option value="kakao_channel|message">ì¹´ì¹´ì˜¤í†¡ ì±„ë„ (kakao_channel / message)</option>
                                                <option value="offline|qr">ì˜¤í”„ë¼ì¸ QR (offline / qr)</option>
                                            </optgroup>
                                            <optgroup label="ğŸ’¬ 2. Paid - ë©”ì‹œì§€ / CRM">
                                                <option value="kakao|message">ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ (kakao / message)</option>
                                                <option value="sms|message">ë¬¸ì (sms / message)</option>
                                            </optgroup>
                                            <optgroup label="ğŸ’° 3. Paid / Advertising (ê´‘ê³ )">
                                                <option value="naver|cpc">ë„¤ì´ë²„ ê²€ìƒ‰ê´‘ê³  (naver / cpc)</option>
                                                <option value="google|cpc">êµ¬ê¸€ ê²€ìƒ‰ê´‘ê³  (google / cpc)</option>
                                                <option value="naver_place|cpc">ë„¤ì´ë²„ í”Œë ˆì´ìŠ¤ ê´‘ê³  (naver_place / cpc)</option>
                                                <option value="danggeun|paid_social">ë‹¹ê·¼ë§ˆì¼“ ê´‘ê³  (danggeun / paid_social)</option>
                                                <option value="youtube|video">ìœ íŠœë¸Œ ê´‘ê³  (youtube / video)</option>
                                                <option value="meta|paid_social">ë©”íƒ€ ê´‘ê³  (IG/FB) (meta / paid_social)</option>
                                                <option value="display|banner">ë””ìŠ¤í”Œë ˆì´ ê´‘ê³  (display / banner)</option>
                                                <option value="press|article">ì–¸ë¡  ê¸°ì‚¬ ê´‘ê³  (press / article)</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <!-- STEP 3 -->
                        <tr>
                            <th>
                                <div class="flex flex-col gap-0.5 items-center">
                                    <span class="bg-blue-600 text-white w-4 h-4 flex items-center justify-center rounded-full text-[9px] mb-0.5">3</span>
                                    <span>ë§í¬ ìƒì„±</span>
                                </div>
                            </th>
                            <td colspan="3">
                                <div class="grid grid-cols-2 gap-4 items-end">
                                    <!-- [Left] Short Code -->
                                    <div>
                                        <label class="block text-[11px] font-bold text-blue-800 mb-1">
                                            ë‹¨ì¶• ì½”ë“œ (Short Code) *
                                            <span class="text-[10px] font-normal text-slate-400 ml-1">*ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, _ Only</span>
                                        </label>
                                        <div class="flex items-center gap-2">
                                            <div class="flex items-center flex-1">
                                                <span class="bg-slate-100 text-slate-500 text-xs px-3 border border-r-0 border-slate-300 rounded-l h-[36px] flex items-center font-mono">go.orderz.kr/</span>
                                                <input type="text" id="in_code" class="input-base rounded-l-none font-bold text-blue-600 h-[36px]" placeholder="sale_2026">
                                            </div>
                                            <button onclick="window.saveLink()" class="bg-blue-600 text-white px-4 h-[36px] rounded text-xs font-bold hover:bg-blue-700 transition shadow-sm whitespace-nowrap active:scale-95 flex items-center">
                                                <i class="fas fa-link mr-1.5"></i> ë§í¬ ìƒì„±
                                            </button>
                                        </div>
                                    </div>
                                    <!-- [Right] Next URL -->
                                    <div class="mb-0.5">
                                        <label class="block text-[11px] font-bold text-slate-700 mb-1">
                                            ì´ë™ ëª©ì ì§€ (Next URL)
                                            <span class="text-[10px] font-normal text-slate-400 ml-1">*ì„ íƒì‚¬í•­ (/ë¡œ ì‹œì‘ í•„ìˆ˜)</span>
                                        </label>
                                        <input type="text" id="in_next" class="input-base" placeholder="/event/coupon.php">
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 2. ê´€ë¦¬ ëª©ë¡ -->
        <section>
            <div class="flex justify-between items-center mb-2">
                <h2 class="text-sm font-bold text-slate-700 border-l-4 border-slate-600 pl-2">ê´€ë¦¬ ëª©ë¡</h2>
                <div class="flex gap-2">
                    <input type="text" id="searchInput" placeholder="ìº í˜ì¸ëª…, ì½”ë“œ ê²€ìƒ‰..." class="border border-slate-300 px-3 py-1.5 text-xs rounded-full w-60 outline-none focus:border-blue-500" onkeyup="window.render()">
                    <button onclick="window.render()" class="text-xs bg-white border border-slate-300 px-2 py-1.5 rounded hover:bg-slate-50" title="ìƒˆë¡œê³ ì¹¨"><i class="fas fa-sync-alt text-slate-500"></i></button>
                </div>
            </div>
            
            <div class="tbl_head_container">
                <table class="tbl_head">
                    <colgroup>
                        <col style="width: 25%"> <!-- ìº í˜ì¸ ì •ë³´ -->
                        <col style="width: 8%">  <!-- ìƒíƒœ -->
                        <col style="width: 12%"> <!-- ì‹œì‘ì¼ -->
                        <col style="width: 8%">  <!-- ì„±ê³¼ -->
                        <col style="width: 47%"> <!-- ë§í¬ ì •ë³´ -->
                    </colgroup>
                    <thead>
                        <tr>
                            <th class="text-left pl-4">ìº í˜ì¸ ì •ë³´</th>
                            <th class="text-center">ìƒíƒœ</th>
                            <th class="text-center">ì‹œì‘ì¼ (ONì‹œì )</th>
                            <th class="text-center">ì„±ê³¼</th>
                            <th class="text-left pl-4">ë§í¬ ì •ë³´ (Short / Target)</th>
                        </tr>
                    </thead>
                    <tbody id="listBody"></tbody>
                </table>
                <div id="emptyMsg" class="hidden py-10 text-center text-xs text-slate-400">ë“±ë¡ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </section>
    </div>

    <!-- Toast UI Container -->
    <div id="toast-container">
        <div class="toast-message">
            <i class="fas fa-check-circle text-green-400"></i>
            <span>ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</span>
        </div>
    </div>

    <!-- Script Block -->
    <script type="module">
        // [Mock Data]
        let links = [
            { id: 1, code: 'sale_2026', memo: '26ë…„ ì„¤ë‚  ê°ì‚¬ ì´ë²¤íŠ¸ (ìš´ì˜ì¤‘)', url: 'https://orderz.kr/join', yt: 'HQ', next: '', utm_source: 'orderz', utm_medium: 'referral', active: true, started_at: '2026-02-01', end_date: '2026-02-28', hits: 152 },
            { id: 2, code: 'insta_winter', memo: 'ê²¨ìš¸ ì‹œì¦Œ ì¸ìŠ¤íƒ€ê·¸ë¨ (ìœ ì…ìˆìŒ)', url: 'https://orderz.kr/main', yt: 'BUSAN_A01', next: '/event/winter', utm_source: 'meta', utm_medium: 'paid_social', active: true, started_at: '2026-01-15', end_date: '', hits: 4500 },
            { id: 3, code: 'inactive_test', memo: 'ë¹„í™œì„± í…ŒìŠ¤íŠ¸ìš© (OFF / Hits 0)', url: 'https://orderz.kr/test', yt: 'TEST', next: '', utm_source: 'sms', utm_medium: 'message', active: false, started_at: '', end_date: '', hits: 0 },
            { id: 4, code: 'expired_event', memo: 'ë§Œë£Œëœ ì´ë²¤íŠ¸ (ì¬í™œì„± í…ŒìŠ¤íŠ¸)', url: 'https://orderz.kr/old', yt: 'HQ', next: '', utm_source: 'kakao', utm_medium: 'message', active: false, started_at: '2025-12-01', end_date: '2025-12-31', hits: 320 }
        ];

        window.render = function() {
            const tbody = document.getElementById('listBody');
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const today = new Date().toISOString().split('T')[0];
            
            tbody.innerHTML = '';
            
            const filtered = links.filter(l => !keyword || l.memo.toLowerCase().includes(keyword) || l.code.toLowerCase().includes(keyword));
            
            if (filtered.length === 0) {
                document.getElementById('emptyMsg').classList.remove('hidden');
            } else {
                document.getElementById('emptyMsg').classList.add('hidden');
            }

            filtered.forEach(link => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition";
                
                const isExpired = link.end_date && link.end_date < today;
                
                let params = [];
                params.push(`utm_source=${link.utm_source}`);
                params.push(`utm_medium=${link.utm_medium}`);
                params.push(`utm_campaign=${link.code}`);
                params.push(`yt_code=${link.yt || 'HQ'}`);
                if(link.next) params.push(`next=${encodeURIComponent(link.next)}`);
                
                const separator = link.url.includes('?') ? '&' : '?';
                const paramStr = params.join('&');
                const shortUrl = `https://go.orderz.kr/${link.code}`;
                const longUrlHtml = `<span class="url-base">${link.url}</span><span class="url-params">${separator}${paramStr}</span>`;
                const dateDisplay = link.started_at ? link.started_at : '<span class="text-slate-300">-</span>';
                
                let statusBadge = '';
                if (isExpired) statusBadge = `<div class="expired-badge"><i class="fas fa-exclamation-circle mr-1"></i>ë§Œë£Œë¨</div>`;
                else if (!link.active) statusBadge = `<div class="off-badge">OFF</div>`;

                tr.innerHTML = `
                    <td class="pl-4 py-3 align-top">
                        <div class="font-bold text-xs mb-1.5 text-slate-800 break-keep pr-2" title="${link.memo}">${link.memo}</div>
                        <div class="flex items-center gap-1.5 flex-wrap">
                            <span class="preset-badge">
                                ${link.utm_source}<span class="medium-badge">/ ${link.utm_medium}</span>
                            </span>
                            <span class="bg-slate-100 px-1.5 py-0.5 rounded text-[9px] text-slate-500 border border-slate-200 font-mono" title="ìœ í†µì‚¬ì½”ë“œ(yt_code)">${link.yt || 'HQ'}</span>
                        </div>
                    </td>
                    <td class="text-center align-top pt-3">
                        <div class="relative inline-block w-8 h-4 select-none">
                            <input type="checkbox" id="toggle_${link.id}" class="toggle-checkbox absolute block w-3 h-3 rounded-full bg-white border border-slate-300 appearance-none cursor-pointer transition-all duration-300 ease-in-out top-0.5 left-0.5" 
                                ${link.active ? 'checked' : ''} onchange="window.toggleActive(${link.id})"/>
                            <label for="toggle_${link.id}" class="toggle-label block overflow-hidden w-8 h-4 rounded-full ${link.active ? 'bg-blue-500' : 'bg-slate-300'} cursor-pointer transition-colors duration-300 ease-in-out"></label>
                        </div>
                        ${statusBadge}
                    </td>
                    <td class="text-center align-top pt-3">
                        <div class="text-[10px] text-slate-600 font-mono mb-1">${dateDisplay}</div>
                        <div class="text-[9px] text-slate-400 flex flex-col items-center">
                            <span>ì¢…ë£Œ:</span>
                            <input type="date" value="${link.end_date || ''}" class="bg-transparent border-b border-dashed border-slate-300 text-center w-20 focus:outline-none focus:border-blue-400 text-[9px] ${isExpired ? 'text-red-500 font-bold' : ''}" onchange="window.updateEndDate(${link.id}, this.value)">
                        </div>
                    </td>
                    <td class="text-center align-top pt-3">
                        <div class="flex flex-col items-center gap-1">
                            <span class="text-xs font-bold font-mono text-slate-700">${link.hits.toLocaleString()}</span>
                            <a href="https://analytics.google.com/" target="_blank" class="text-[9px] text-slate-400 hover:text-blue-600" title="GA4 ë¦¬í¬íŠ¸"><i class="fas fa-chart-line"></i></a>
                        </div>
                    </td>
                    <td class="pl-4 py-3 align-top">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex flex-col gap-2 flex-1">
                                <div class="url-text font-bold text-blue-600 hover:underline cursor-pointer truncate" onclick="window.open('${shortUrl}')">${shortUrl}</div>
                                <div class="url-text url-text-target select-all">${longUrlHtml}</div>
                            </div>
                            <div class="copy-btn-wrapper shrink-0 pt-1">
                                <button onclick="window.copyToClipboard('${shortUrl}', this)" class="btn-copy-circle" title="ë‹¨ì¶•ë§í¬ ë³µì‚¬">
                                    <i class="far fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        };

        window.saveLink = function() {
            const memo = document.getElementById('in_memo').value.trim();
            const url = document.getElementById('in_url').value.trim();
            const code = document.getElementById('in_code').value.trim();
            const channelSelect = document.getElementById('in_channel');
            const yt = document.getElementById('in_yt').value.trim() || 'HQ';
            const next = document.getElementById('in_next').value.trim();

            if(!memo || !url || !code) return alert("í•„ìˆ˜ í•­ëª©(*)ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            
            // [ê·œì¹™ 2] ë‹¨ì¶• ì½”ë“œ ì¤‘ë³µ ì²´í¬ (UNIQUE)
            if(links.some(l => l.code === code)) return alert(`[ìƒì„± ì‹¤íŒ¨] ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹¨ì¶• ì½”ë“œì…ë‹ˆë‹¤: ${code}`);

            // [ê·œì¹™ 2] ë‹¨ì¶• ì½”ë“œ í˜•ì‹ ê²€ì¦ (ì˜ì†Œë¬¸ì, ìˆ«ì, _)
            const codeRegex = /^[a-z0-9_]+$/;
            if(!codeRegex.test(code)) return alert("[ìƒì„± ì‹¤íŒ¨] ë‹¨ì¶• ì½”ë“œëŠ” ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, ì–¸ë”ë°”(_)ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.");

            // [ê·œì¹™ 7] Next URL í˜•ì‹ ê²€ì¦ (ë‚´ë¶€ ê²½ë¡œë§Œ í—ˆìš©)
            if(next && !next.startsWith('/')) return alert("[ìƒì„± ì‹¤íŒ¨] ì´ë™ ëª©ì ì§€(Next URL)ëŠ” ë°˜ë“œì‹œ '/'ë¡œ ì‹œì‘í•˜ëŠ” ë‚´ë¶€ ê²½ë¡œì—¬ì•¼ í•©ë‹ˆë‹¤.\nì˜ˆ: /event/coupon.php");

            const presetVal = channelSelect.value;
            const [utm_source, utm_medium] = presetVal.split('|');
            
            links.unshift({
                id: Date.now(),
                code, memo, url, yt, next,
                utm_source, utm_medium,
                active: false,    // [ê·œì¹™ 3] ìƒì„± ì‹œ í•­ìƒ OFF
                started_at: '',   // [ê·œì¹™ 3] ìƒì„± ì‹œ ì‹œì‘ì¼ ì—†ìŒ
                end_date: '', 
                hits: 0
            });
            window.render();
            
            document.getElementById('in_code').value = '';
            document.getElementById('in_memo').value = '';
            document.getElementById('in_next').value = '';
            alert("âœ… ìº í˜ì¸ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ê¸°ë³¸ ìƒíƒœëŠ” OFF ì…ë‹ˆë‹¤. ê²€í†  í›„ í™œì„±í™”í•´ì£¼ì„¸ìš”.)");
        };

        window.toggleActive = function(id) {
            const item = links.find(l => String(l.id) === String(id));
            if (!item) return;

            const checkbox = document.getElementById(`toggle_${id}`);
            const isTurningOn = !item.active; 

            // [ê·œì¹™ 5] ë§Œë£Œëœ ë§í¬ ì¬í™œì„±í™” ë°©ì–´
            const today = new Date().toISOString().split('T')[0];
            if (isTurningOn && item.end_date && item.end_date < today) {
                alert(`ğŸš« ê¸°ê°„ ë§Œë£Œ (Expired)\n\nì„¤ì •ëœ ì¢…ë£Œì¼(${item.end_date})ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤.\n\nì¬í™œì„±í™” í•˜ë ¤ë©´ ë¨¼ì € [ì¢…ë£Œì¼]ì„\nì˜¤ëŠ˜ ì´í›„ë¡œ ì—°ì¥í•´ì£¼ì„¸ìš”.`);
                checkbox.checked = false; 
                return; 
            }

            // ìƒíƒœ ë³€ê²½
            item.active = !item.active;
            
            // [ê·œì¹™ 4] ON ì „í™˜ ì‹œ started_at ì—†ìœ¼ë©´ ì˜¤ëŠ˜ ë‚ ì§œ ì„¸íŒ…
            if (item.active && !item.started_at) {
                item.started_at = today;
            }
            window.render();
        };

        window.updateEndDate = function(id, val) {
            const item = links.find(l => String(l.id) === String(id));
            if (item) {
                item.end_date = val;
                window.render();
            }
        };

        window.copyToClipboard = function(text, btnElement) {
            // 1. Copy Logic
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            textArea.select();
            
            let successful = false;
            try {
                successful = document.execCommand('copy');
            } catch (err) {
                console.error('Fallback copy failed', err);
            }
            document.body.removeChild(textArea);

            // 2. Feedback Logic
            if (successful) {
                // A. Toast UI
                const toast = document.getElementById('toast-container');
                toast.classList.add('show');
                setTimeout(() => { toast.classList.remove('show'); }, 2000);

                // B. Button UI (Icon Change)
                if (btnElement) {
                    const originalContent = btnElement.innerHTML;
                    const originalClass = btnElement.className;
                    
                    // Change Style (Success State)
                    btnElement.innerHTML = '<i class="fas fa-check"></i>';
                    // Tailwind utility classes for Green style
                    btnElement.classList.remove('text-slate-500', 'hover:text-blue-600', 'btn-copy-circle');
                    btnElement.className = "w-[32px] h-[32px] rounded-full border border-green-500 bg-green-50 text-green-500 flex items-center justify-center transition-all";
                    
                    // Revert after 1.5s
                    setTimeout(() => {
                        btnElement.innerHTML = originalContent;
                        btnElement.className = originalClass;
                    }, 1500);
                }
            } else {
                prompt("ë³µì‚¬í•˜ê¸°: Ctrl+Cë¥¼ ëˆŒëŸ¬ ë³µì‚¬í•˜ì„¸ìš”", text);
            }
        };

        window.render();
    </script>
</body>
</html>
