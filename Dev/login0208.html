<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì˜¤ë”ì¦ˆ - ì‹ìì¬ ì£¼ë¬¸ì˜ ìƒˆë¡œìš´ ê¸°ì¤€</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        :root { 
            --brand-primary: #14682A; 
            --brand-hover: #0f5220; 
            --box-bg: #f8fafc; 
            --required-color: #f472b6;
        }
        /* [Layout] Flex Column ì ìš©í•˜ì—¬ ìˆ˜ì§ ë¦¬ë“¬ ì œì–´ */
        .check-container { 
            max-width: 480px; margin: 0 auto; background-color: #ffffff; 
            min-height: 100vh; 
            display: flex; flex-direction: column;
            padding: 0 24px; /* ìƒí•˜ íŒ¨ë”©ì€ ê°œë³„ ìš”ì†Œì—ì„œ ì œì–´ */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); position: relative; 
        }
        
        /* Checkbox & Inputs */
        .checkbox-wrapper input:checked + div { background-color: var(--brand-primary); border-color: var(--brand-primary); }
        .checkbox-wrapper input:checked + div svg { display: block; }
        .input-focus:focus { outline: none; border-color: var(--brand-primary); box-shadow: 0 0 0 1px var(--brand-primary); background-color: #fff; }
        .input-box-style { background-color: var(--box-bg); }
        .placeholder-required::placeholder { color: #9ca3af; font-weight: 400; }

        /* Buttons */
        .btn-kakao { background-color: #FEE500; color: #191919; }
        .btn-brand { background-color: var(--brand-primary); color: white; }
        .btn-brand:hover { background-color: var(--brand-hover); }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-out forwards; } /* ì‹œê°„ì„ ì¡°ê¸ˆ ëŠ˜ë ¤ ë¶€ë“œëŸ½ê²Œ */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none; }
        
        /* Modals */
        #toast-overlay, #kakao-sync-modal, #kakao-connect-modal, #sim-settings-modal {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6); z-index: 5000;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        #toast-overlay.show, #kakao-sync-modal.show, #kakao-connect-modal.show, #sim-settings-modal.show { opacity: 1; pointer-events: all; }
        
        .modal-window { width: 90%; max-width: 360px; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .kakao-window { width: 100%; max-width: 360px; background: #fff; height: auto; border-radius: 8px; overflow: hidden; }

        /* Step Indicator */
        .step-dots { display: flex; justify-content: center; gap: 8px; margin-bottom: 24px; }
        .dot { width: 8px; height: 8px; border-radius: 50%; background-color: #e5e7eb; transition: background-color 0.3s; }
        .dot.active { background-color: var(--brand-primary); }

        /* Sim Settings Modal Specifics */
        .sim-option {
            border: 1px solid #e2e8f0; padding: 12px; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .sim-option:hover { background-color: #f8fafc; }
        .sim-option.selected { border-color: #3b82f6; background-color: #eff6ff; color: #1d4ed8; font-weight: bold; }
        .sim-check { width: 16px; height: 16px; border: 1px solid #cbd5e1; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .sim-option.selected .sim-check { border-color: #3b82f6; background-color: #3b82f6; }
        .sim-option.selected .sim-check::after { content: ''; width: 6px; height: 6px; background: white; border-radius: 50%; display: block; }
    </style>
</head>
<body>

    <div class="check-container relative">
        
        <!-- Header: [ìƒë‹¨ ì—¬ë°±] + Logo -->
        <!-- pt-12 (48px) ì ìš©í•˜ì—¬ ì‹œì›í•œ ìƒë‹¨ ê³µê°„ í™•ë³´ -->
        <div class="flex justify-between items-center mb-2 pt-12">
            <div class="w-8"></div> <!-- Spacer -->
            <h1 class="text-3xl font-black text-[#14682A] tracking-tight cursor-pointer" onclick="location.reload()">ORDERZ</h1>
            <button onclick="openSimSettings()" class="w-8 h-8 flex items-center justify-center text-gray-400 hover:text-gray-600">
                <i class="fas fa-cog"></i>
            </button>
        </div>

        <div class="step-dots hidden" id="step-indicator">
            <div id="dot1" class="dot active"></div>
            <div id="dot2" class="dot"></div>
        </div>

        <form id="joinForm" onsubmit="return false;" class="flex-1 flex flex-col">
            <input type="hidden" name="yt_code" id="yt_code"> 
            <input type="hidden" name="join_source" id="join_source">
            <input type="hidden" name="next_url" id="next_url">
            <input type="hidden" name="join_type" id="join_type" value="general">

            <!-- ================= í†µí•© ê²Œì´íŠ¸ì›¨ì´ ================= -->
            <div id="step1_section" class="fade-in flex flex-col h-full">
                
                <!-- [ì¸ì§€ ì˜ì—­] ìŠ¬ë¡œê±´ -->
                <!-- mb-16 (64px) ì ìš©í•˜ì—¬ ë²„íŠ¼ê³¼ í™•ì‹¤í•œ ê±°ë¦¬ë‘ê¸° -->
                <div class="text-center mb-16 mt-4" id="intro-text">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">ì˜¤ë”ì¦ˆê°€ ê¸°ì–µí•©ë‹ˆë‹¤</h2>
                    <p class="text-sm font-medium text-[#14682A]">
                        ë‚´ ë°©ì‹ëŒ€ë¡œ, ì“¸ìˆ˜ë¡ ì†ì— ìµëŠ” í”Œë«í¼
                    </p>
                </div>

                <!-- [ì¼ë°˜ ê°€ì…/ë¡œê·¸ì¸ í¼] -->
                <div id="generalInputArea" class="hidden fade-in mb-8">
                    <div class="mb-5">
                        <label class="block text-sm font-bold text-gray-700 mb-1.5">
                            íœ´ëŒ€í° ë²ˆí˜¸
                        </label>
                        <input type="tel" name="mb_hp" id="mb_hp" maxlength="13"
                            class="w-full px-4 py-3.5 border border-gray-200 rounded-lg input-box-style input-focus transition-colors text-sm placeholder-required"
                            placeholder="010-0000-0000" oninput="autoHyphen(this)">
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4 input-box-style hover:border-[#14682A] transition-colors cursor-pointer" onclick="document.getElementById('agree_all').click()">
                        <label class="checkbox-wrapper flex items-start cursor-pointer group select-none pointer-events-none">
                            <input type="checkbox" name="agree_all" id="agree_all" class="hidden" required>
                            <div class="w-5 h-5 border-2 border-gray-300 rounded flex items-center justify-center mr-3 mt-0.5 transition-colors bg-white shrink-0">
                                <svg class="w-3 h-3 text-white hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                            </div>
                            <div>
                                <span class="text-sm font-bold text-gray-800">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- [ê¸°ì¡´ ì•„ì´ë”” ë¡œê·¸ì¸ í¼] -->
                <div id="loginFormArea" class="hidden fade-in mb-8">
                    <div class="text-center mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-1">ë¡œê·¸ì¸</h3>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-bold text-gray-700 mb-1.5">ì•„ì´ë”” <span class="text-pink-400 text-xs font-normal ml-0.5">(í•„ìˆ˜)</span></label>
                        <input type="text" name="login_id" id="login_id" value="test_owner"
                            class="w-full px-4 py-3.5 border border-gray-200 rounded-lg input-box-style input-focus transition-colors text-sm placeholder-required"
                            placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-bold text-gray-700 mb-1.5">ë¹„ë°€ë²ˆí˜¸ <span class="text-pink-400 text-xs font-normal ml-0.5">(í•„ìˆ˜)</span></label>
                        <input type="password" name="login_pw" id="login_pw" value="1234"
                            class="w-full px-4 py-3.5 border border-gray-200 rounded-lg input-box-style input-focus transition-colors text-sm"
                            placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <p class="text-[11px] text-gray-500 text-center mb-2.5 break-keep leading-snug">
                        <i class="fas fa-lightbulb text-yellow-500 mr-1"></i>ì¹´ì¹´ì˜¤ ê³„ì •ì„ ì—°ê²°í•˜ë©´, ë‹¤ìŒë¶€í„°ëŠ”<br>
                        <strong>ì•„ì´ë”” ì…ë ¥ ì—†ì´ ê°„í¸í•˜ê²Œ ì ‘ì†</strong>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>

                    <button type="button" onclick="processConnectLogin()"
                        class="w-full py-4 btn-brand rounded-lg font-bold text-[15px] shadow-md transition hover:bg-[#0f5220]">
                        ë¡œê·¸ì¸ (ì¹´ì¹´ì˜¤ ì—°ê²°)
                    </button>
                    
                    <div class="mt-4 text-center">
                        <button onclick="processJustLogin()" class="text-xs text-gray-400 underline hover:text-gray-600">
                            ì—°ê²° ì—†ì´ ë¡œê·¸ì¸
                        </button>
                    </div>
                </div>

                <!-- [í–‰ë™ ì˜ì—­] ë©”ì¸ ë²„íŠ¼ ê·¸ë£¹ -->
                <!-- ìƒë‹¨ ì»¨í…ì¸ ì™€ ê°„ê²©ì„ ë‘ì–´ ë…ë¦½ì„± í™•ë³´ -->
                <div class="flex flex-col gap-3" id="mainBtnGroup">
                    <!-- 1. ì¹´ì¹´ì˜¤ (Main) -->
                    <button type="button" id="btnKakao" onclick="processKakaoGateway()"
                        class="w-full py-4 rounded-lg font-bold text-[15px] btn-kakao flex items-center justify-center gap-2 shadow-sm hover:opacity-90 transition">
                        <i class="fas fa-comment text-lg"></i>
                        ì‹œì‘í•˜ê¸°
                    </button>

                    <!-- 2. ì¼ë°˜/ë‹¤ë¥¸ ë°©ë²• (Secondary) - ê°„ê²© í™•ë³´ -->
                    <button type="button" id="btnGeneral" onclick="showGeneralInput()"
                        class="w-full py-3 rounded-lg font-medium text-sm text-gray-500 hover:text-gray-800 hover:bg-gray-100 transition underline decoration-1 underline-offset-4 mt-2">
                        (ë¹„íšŒì›) ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ê³„ì†í•˜ê¸°
                    </button>
                    
                    <button type="button" id="btnStep1Next" onclick="processGeneralGateway()"
                        class="w-full py-4 btn-brand rounded-lg font-bold text-[15px] shadow-md transition hidden">
                        ê³„ì†í•˜ê¸°
                    </button>
                </div>

                <!-- [ì„ íƒ ì˜ì—­] í•˜ë‹¨ ë§í¬ -->
                <!-- mt-8 (32px) ì ìš©í•˜ì—¬ ë©”ì¸ í–‰ë™ê³¼ ë¶„ë¦¬ -->
                <div class="mt-8 mb-8 text-center" id="loginLinkArea">
                    <button type="button" onclick="showLoginForm()" class="text-xs text-gray-400 font-normal hover:text-gray-600 transition-colors">
                        <span class="border-b border-gray-300 pb-0.5">ì•„ì´ë””ë¡œ ë¡œê·¸ì¸</span>
                    </button>
                </div>
                
                <!-- ë¡œê·¸ì¸í¼ì—ì„œ ëŒì•„ê°€ê¸° ë§í¬ -->
                <div class="mt-8 mb-8 text-center hidden" id="backLinkArea">
                    <button type="button" onclick="resetToMain()" class="text-xs text-gray-400 font-normal hover:text-gray-600 transition-colors">
                        <span class="border-b border-gray-300 pb-0.5">ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
                    </button>
                </div>

            </div>

            <!-- ================= STEP 2: ì •ë³´ ì¶”ê°€ ì…ë ¥ ================= -->
            <div id="step2_section" class="hidden">
                <div class="mb-10 mt-6 text-center">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">ì£¼ì†Œ ê¸°ë°˜ ìƒí’ˆ ë§¤ì¹­</h2>
                    <p class="text-sm font-medium text-[#14682A] break-keep">
                        ì‚¬ì¥ë‹˜ ì§€ì—­ì˜ íŠ¹ê°€ ìƒí’ˆì„ ì§€ê¸ˆ í™•ì¸í•´ë³´ì„¸ìš”.
                    </p>
                </div>

                <div class="mb-5">
                    <label class="block text-sm font-bold text-gray-700 mb-1.5">
                        ìƒí˜¸ëª… <span class="text-pink-400 text-xs font-normal ml-0.5">(í•„ìˆ˜)</span>
                    </label>
                    <input type="text" name="mb_company" id="mb_company" 
                        class="w-full px-4 py-3.5 border border-gray-200 rounded-lg input-box-style input-focus transition-colors text-sm placeholder-required"
                        placeholder="ìƒí˜¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" onkeydown="handleCompanyKeydown(event)">
                </div>

                <div class="mb-8">
                    <label class="block text-sm font-bold text-gray-700 mb-1.5">
                        ê°€ê²Œ ì£¼ì†Œ (ë°°ì†¡ì§€) <span class="text-pink-400 text-xs font-normal ml-0.5">(í•„ìˆ˜)</span>
                    </label>
                    <div class="flex gap-2 mb-2">
                        <input type="hidden" name="mb_zip" id="mb_zip">
                        <input type="hidden" name="mb_addr3" id="mb_addr3">
                        <input type="text" name="mb_addr1" id="mb_addr1" 
                            class="flex-1 px-4 py-3.5 border border-gray-200 rounded-lg input-box-style text-gray-800 text-sm input-focus cursor-pointer placeholder-required"
                            placeholder="ìš°ì¸¡ ë²„íŠ¼ìœ¼ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”" readonly onclick="openDaumPostcode()">
                        <button type="button" onclick="openDaumPostcode()" 
                            class="px-5 py-3.5 btn-brand text-sm font-bold rounded-lg transition whitespace-nowrap shadow-sm">
                            ê²€ìƒ‰
                        </button>
                    </div>
                    <input type="text" name="mb_addr2" id="mb_addr2" 
                        class="w-full px-4 py-3.5 border border-gray-200 rounded-lg input-box-style input-focus text-sm transition-colors"
                        placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: 1ì¸µ)" >
                </div>

                <button type="button" onclick="submitFinalForm()"
                    class="w-full py-4 btn-brand rounded-lg font-bold text-[15px] shadow-md transition hover:bg-[#0f5220]">
                    ì™„ë£Œ
                </button>
                
                <!-- Step 2ì—ì„œ ëŒì•„ê°€ê¸° -->
                <div class="mt-6 text-center">
                    <button type="button" onclick="resetToMain()" class="text-xs text-gray-400 font-normal hover:text-gray-600 transition-colors">
                        <span class="border-b border-gray-300 pb-0.5">ì´ì „ìœ¼ë¡œ</span>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- [Simulation Settings Modal] -->
    <div id="sim-settings-modal">
        <div class="modal-window p-5">
            <div class="flex justify-between items-center mb-4 border-b pb-3">
                <h3 class="font-bold text-gray-800"><i class="fas fa-tools mr-2 text-gray-400"></i>ì‹œë®¬ë ˆì´ì…˜ í™˜ê²½ ì„¤ì •</h3>
                <button onclick="closeSimSettings()" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="mb-4">
                <p class="text-xs font-bold text-gray-500 mb-2">1. ëŒ€ìƒ íšŒì› ìƒíƒœ</p>
                <div class="sim-option selected" id="opt-user-new" onclick="setSimState('user', 'NEW')">
                    <span class="text-sm">ì‹ ê·œ íšŒì› (ê°€ì… ë¯¸ì™„ë£Œ)</span>
                    <div class="sim-check"></div>
                </div>
                <div class="sim-option" id="opt-user-exist" onclick="setSimState('user', 'EXISTING')">
                    <span class="text-sm">ê¸°ì¡´ íšŒì› (ê°€ì… ì™„ë£Œ)</span>
                    <div class="sim-check"></div>
                </div>
            </div>

            <div class="mb-5">
                <p class="text-xs font-bold text-gray-500 mb-2">2. ìœ ì… ê²½ë¡œ (Context)</p>
                <div class="sim-option selected" id="opt-flow-mkt" onclick="setSimState('flow', 'MARKETING')">
                    <span class="text-sm">ë§ˆì¼€íŒ… ë§í¬ ìœ ì… (yt_code ìˆìŒ)</span>
                    <div class="sim-check"></div>
                </div>
                <div class="sim-option" id="opt-flow-org" onclick="setSimState('flow', 'ORGANIC')">
                    <span class="text-sm">ì¼ë°˜/ìì—° ìœ ì… (yt_code ì—†ìŒ)</span>
                    <div class="sim-check"></div>
                </div>
            </div>

            <button onclick="applySimSettings()" class="w-full bg-[#14682A] text-white py-3 rounded-lg font-bold text-sm shadow hover:bg-[#0f5220]">
                ì„¤ì • ì ìš© ë° ìƒˆë¡œê³ ì¹¨
            </button>
        </div>
    </div>

    <!-- [ì¹´ì¹´ì˜¤ì‹±í¬ ê°€ìƒ ì°½] -->
    <div id="kakao-sync-modal">
        <div class="kakao-window shadow-2xl p-6 bg-white">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center">
                    <i class="fas fa-comment text-[#3c1e1e] text-lg mr-2"></i>
                    <span class="font-bold text-sm text-[#3c1e1e]">Kakao</span>
                </div>
                <button onclick="closeKakaoSync()" class="text-gray-400"><i class="fas fa-times"></i></button>
            </div>
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gray-100 rounded-full mx-auto mb-3 flex items-center justify-center">
                    <span class="font-black text-[#14682A]">ORDERZ</span>
                </div>
                <h3 class="font-bold text-lg text-gray-800 mb-1">ì˜¤ë”ì¦ˆ</h3>
                <p class="text-xs text-gray-500">ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ ì •ë³´ ì œê³µì— ë™ì˜í•´ì£¼ì„¸ìš”.</p>
            </div>
            <div class="border-t border-gray-100 pt-4 space-y-3 text-sm text-left">
                <div class="flex items-start"><i class="fas fa-check-circle text-[#FEE500] mt-0.5 mr-2"></i><div><span class="text-gray-500">[í•„ìˆ˜]</span> í”„ë¡œí•„ ì •ë³´</div></div>
                <div class="flex items-start"><i class="fas fa-check-circle text-[#FEE500] mt-0.5 mr-2"></i><div><span class="text-gray-500">[í•„ìˆ˜]</span> ì¹´ì¹´ì˜¤ê³„ì •(ì „í™”ë²ˆí˜¸)</div></div>
                <div class="flex items-start"><i class="fas fa-check-circle text-[#FEE500] mt-0.5 mr-2"></i><div><span class="text-gray-500">[í•„ìˆ˜]</span> ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</div></div>
            </div>
            <div class="mt-6">
                <button onclick="confirmKakaoSync()" class="w-full bg-[#FEE500] text-[#191919] py-3.5 rounded font-bold hover:bg-[#fdd835] transition text-sm">ë™ì˜í•˜ê³  ê³„ì†í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <!-- [ì¹´ì¹´ì˜¤ ì—°ë™ ìœ ë„ ëª¨ë‹¬] -->
    <div id="kakao-connect-modal">
        <div class="modal-window">
            <div class="bg-blue-50 p-4 border-b border-blue-100 flex justify-between items-center">
                <h3 class="font-bold text-gray-800 text-sm flex items-center">
                    <i class="fas fa-link text-blue-500 mr-2 text-lg"></i>
                    ê¸°ì¡´ ê³„ì •ì— ì—°ê²°í•˜ê¸°
                </h3>
                <button onclick="skipKakaoConnect()" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6 bg-white text-center">
                <div class="mb-4">
                    <i class="fas fa-user-shield text-4xl text-gray-300 mb-3"></i>
                    <h4 class="text-lg font-bold text-gray-800 mb-2">ë¡œê·¸ì¸ ì„±ê³µ!</h4>
                    <p class="text-sm text-gray-500 leading-relaxed break-keep">
                        ì‚¬ì¥ë‹˜, ë§¤ë²ˆ ì•„ì´ë”” ì…ë ¥í•˜ê¸° ë²ˆê±°ë¡œìš°ì‹œì£ ?<br>
                        <span class="text-blue-600 font-bold underline decoration-2 underline-offset-2">ì§€ê¸ˆ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì—°ê²°</span>í•´ë‘ì‹œë©´<br>
                        ë‹¤ìŒë¶€í„°ëŠ” 1ì´ˆ ë§Œì— ì ‘ì†ë©ë‹ˆë‹¤.
                    </p>
                </div>
                
                <!-- í‡´ì‚¬ ê´€ë ¨ ë³´ì•ˆ ê²½ê³  -->
                <div class="mt-3 bg-red-50 border border-red-100 rounded p-3 text-left">
                    <p class="text-[11px] text-red-500 leading-snug break-keep">
                        <i class="fas fa-exclamation-triangle mr-1"></i>
                        <strong>ë³´ì•ˆ ì£¼ì˜:</strong> ì—°ê²°ëœ ê³„ì • í•´ì œëŠ” í˜„ì¬ <strong>ê³ ê°ì„¼í„°</strong>ë¥¼ í†µí•´ì„œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
                        <span class="underline decoration-red-300">ì§ì› í‡´ì‚¬ ì‹œ ì •ë³´ ë³´í˜¸ë¥¼ ìœ„í•´ ë°˜ë“œì‹œ ì—°ê²° í•´ì œë¥¼ ìš”ì²­í•´ì£¼ì„¸ìš”.</span>
                    </p>
                </div>
            </div>
            <div class="p-4 bg-gray-50 border-t border-gray-100 flex flex-col gap-2">
                <button onclick="confirmKakaoConnect()" class="w-full bg-[#FEE500] text-[#191919] py-3 rounded-lg font-bold text-sm hover:bg-[#fdd835] transition flex items-center justify-center shadow-sm">
                    <i class="fas fa-comment mr-2"></i> ì§€ê¸ˆ ì—°ê²°í•˜ê¸°
                </button>
                <button onclick="skipKakaoConnect()" class="w-full py-2 text-xs text-gray-400 underline hover:text-gray-600">
                    ë‹¤ìŒì— í•˜ê¸° (ê·¸ëƒ¥ ì´ë™)
                </button>
            </div>
        </div>
    </div>

    <!-- ì„±ê³µ íŒì—… (ë²„íŠ¼ ì¶”ê°€ë¨) -->
    <div id="toast-overlay">
        <div class="bg-white rounded-xl p-6 w-[320px] text-center shadow-2xl transform scale-100 transition-transform">
            <div class="w-12 h-12 bg-green-50 text-[#14682A] rounded-full flex items-center justify-center mx-auto mb-4 text-xl">
                <i class="fas fa-check"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-800 mb-2" id="toast-title">ë¡œê·¸ì¸ ì™„ë£Œ</h3>
            <div class="text-sm text-gray-600 mb-4 leading-relaxed break-keep" id="toast-desc"></div>
            
            <div id="toast-loading" class="w-full bg-gray-200 rounded-full h-1.5 overflow-hidden mb-2">
                <div class="bg-[#14682A] h-full w-0 transition-all duration-[1500ms] ease-out" id="progress-bar"></div>
            </div>

            <div id="toast-btn-area" class="hidden mt-4">
                 <button onclick="goToNextPage()" class="w-full bg-[#14682A] text-white py-3 rounded-lg font-bold text-sm hover:bg-[#0f5220] transition shadow-md">
                    í™•ì¸ (ì´ë™í•˜ê¸°)
                </button>
            </div>
        </div>
    </div>

    <script>
        let simConfig = { userType: 'NEW', flowType: 'ORGANIC' };

        window.addEventListener('DOMContentLoaded', () => { initPage(); });

        function initPage() {
            if (simConfig.flowType === 'MARKETING') {
                document.getElementById('yt_code').value = 'TEST_CODE';
                document.querySelector('#intro-text h2').innerText = "ìš°ë¦¬ ê°€ê²Œ ì‹ìì¬, ë” ì‹¸ê³  í¸ë¦¬í•˜ê²Œ";
                document.querySelector('#intro-text p').innerHTML = "ì‚¬ì¥ë‹˜! ìš°ë¦¬ë™ë„¤ íŠ¹ê°€ ìƒí’ˆì„<br>ì§€ê¸ˆ í™•ì¸í•´ë³´ì„¸ìš”.";
                document.getElementById('step-indicator').classList.remove('hidden');
                // ë§ˆì¼€íŒ… ì‹œ ë²„íŠ¼ ë¬¸êµ¬ (ì„ íƒì )
                // document.getElementById('btnKakao').innerHTML = '<i class="fas fa-comment text-lg"></i> ì¹´ì¹´ì˜¤ë¡œ ê³„ì†í•˜ê¸°';
            } else {
                document.getElementById('yt_code').value = '';
                document.querySelector('#intro-text h2').innerText = "ì˜¤ë”ì¦ˆê°€ ê¸°ì–µí•©ë‹ˆë‹¤";
                document.querySelector('#intro-text p').innerText = "ë‚´ ë°©ì‹ëŒ€ë¡œ, ì“¸ìˆ˜ë¡ ì†ì— ìµëŠ” í”Œë«í¼";
                document.getElementById('step-indicator').classList.add('hidden');
                // ì¼ë°˜ ì‹œ ë²„íŠ¼ ë¬¸êµ¬
                // document.getElementById('btnKakao').innerHTML = '<i class="fas fa-comment text-lg"></i> ì‹œì‘í•˜ê¸°';
            }

            const urlParams = new URLSearchParams(window.location.search);
            const nextUrl = urlParams.get('next_url') || 'https://orderz.kr/shop/';
            document.getElementById('next_url').value = nextUrl;
        }

        // --- Settings ---
        function openSimSettings() { updateSimUI('user', simConfig.userType); updateSimUI('flow', simConfig.flowType); document.getElementById('sim-settings-modal').classList.add('show'); }
        function closeSimSettings() { document.getElementById('sim-settings-modal').classList.remove('show'); }
        function setSimState(group, value) { if(group==='user') simConfig.userType=value; if(group==='flow') simConfig.flowType=value; updateSimUI(group, value); }
        function updateSimUI(group, value) {
            const opts = group==='user'?['new','exist']:['mkt','org'];
            const valMap = group==='user'?{new:'NEW',exist:'EXISTING'}:{mkt:'MARKETING',org:'ORGANIC'};
            opts.forEach(opt=>{
                const el=document.getElementById(`opt-${group}-${opt}`);
                if(valMap[opt]===value) el.classList.add('selected'); else el.classList.remove('selected');
            });
        }
        function applySimSettings() {
            closeSimSettings();
            document.getElementById('step1_section').classList.remove('hidden');
            document.getElementById('step1_section').classList.add('fade-in');
            document.getElementById('step2_section').classList.add('hidden');
            document.getElementById('step2_section').classList.remove('fade-in');
            const dot2 = document.getElementById('dot2'); if(dot2) dot2.classList.remove('active');
            initPage(); resetToMain();
            alert(`[ì„¤ì • ì™„ë£Œ]\níšŒì›: ${simConfig.userType}\nìœ ì…: ${simConfig.flowType}\n\nì´ˆê¸° í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
        }

        // --- Auth ---
        function processKakaoGateway() {
            if (simConfig.userType === 'EXISTING') { completeLogin('EXISTING'); } 
            else { document.getElementById('kakao-sync-modal').classList.add('show'); }
        }
        function closeKakaoSync() { document.getElementById('kakao-sync-modal').classList.remove('show'); }
        function confirmKakaoSync() {
            closeKakaoSync();
            if (simConfig.userType === 'EXISTING') { completeLogin('EXISTING'); } 
            else { document.getElementById('join_type').value = 'kakao'; goToStep2(); }
        }
        function processGeneralGateway() {
            const hp = document.getElementById('mb_hp');
            if(!hp.value || hp.value.length < 10) { alert("íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”."); hp.focus(); return; }
            if (simConfig.userType === 'EXISTING') { completeLogin('EXISTING'); } else { goToStep2(); }
        }

        // --- Navigation ---
        function showLoginForm() {
            document.getElementById('mainBtnGroup').classList.add('hidden');
            document.getElementById('generalInputArea').classList.add('hidden');
            document.getElementById('loginLinkArea').classList.add('hidden');
            document.getElementById('loginFormArea').classList.remove('hidden');
            document.getElementById('backLinkArea').classList.remove('hidden');
            document.getElementById('login_id').focus();
        }
        function showGeneralInput() {
            document.getElementById('mainBtnGroup').classList.add('hidden');
            document.getElementById('generalInputArea').classList.remove('hidden');
            document.getElementById('btnStep1Next').classList.remove('hidden');
            document.getElementById('backLinkArea').classList.remove('hidden');
            document.getElementById('mb_hp').focus();
            document.getElementById('join_type').value = 'general';
        }
        function resetToMain() {
            document.getElementById('mainBtnGroup').classList.remove('hidden');
            document.getElementById('loginLinkArea').classList.remove('hidden');
            document.getElementById('generalInputArea').classList.add('hidden');
            document.getElementById('loginFormArea').classList.add('hidden');
            document.getElementById('btnStep1Next').classList.add('hidden');
            document.getElementById('backLinkArea').classList.add('hidden');
        }

        // --- ID Login ---
        function processConnectLogin() {
            const id = document.getElementById('login_id').value;
            const pw = document.getElementById('login_pw').value;
            if(!id || !pw) { alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            completeLogin('LINKED');
        }
        function processJustLogin() {
            const id = document.getElementById('login_id').value;
            const pw = document.getElementById('login_pw').value;
            if(!id || !pw) { alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            completeLogin('JUST_LOGIN');
        }
        function processIdLogin() { processConnectLogin(); } // Fallback

        function goToStep2() {
            document.getElementById('step1_section').classList.add('hidden');
            const step2 = document.getElementById('step2_section');
            step2.classList.remove('hidden');
            step2.classList.add('fade-in');
            const dot2 = document.getElementById('dot2'); if(dot2) dot2.classList.add('active');
            setTimeout(() => { 
                const companyInput = document.getElementById('mb_company');
                companyInput.focus(); companyInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }

        function submitFinalForm() {
            const company = document.getElementById('mb_company');
            const addr1 = document.getElementById('mb_addr1');
            if(!company.value) { alert("ìƒí˜¸ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); company.focus(); return; }
            if(!addr1.value) { alert("ì£¼ì†Œë¥¼ ê²€ìƒ‰í•´ì£¼ì„¸ìš”."); openDaumPostcode(); return; }
            completeLogin('NEW');
        }

        function completeLogin(type) {
            const toast = document.getElementById('toast-overlay');
            const bar = document.getElementById('progress-bar');
            const title = document.getElementById('toast-title');
            const desc = document.getElementById('toast-desc');
            const loadingArea = document.getElementById('toast-loading');
            const btnArea = document.getElementById('toast-btn-area');

            // Reset
            loadingArea.classList.remove('hidden');
            btnArea.classList.add('hidden');
            bar.style.width = '0%';

            if (type === 'LINKED') {
                title.innerText = "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ì—°ê²° ì„±ê³µ!";
                desc.innerHTML = `
                    ì´ì œ ì¹´ì¹´ì˜¤ ê³„ì •ìœ¼ë¡œ<br>ë” ë¹ ë¥´ê²Œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br>
                    <div class="text-[11px] bg-gray-50 p-2 rounded text-left border border-gray-100 space-y-1">
                        <p class="text-gray-500">ğŸ“¢ ì—°ê²°ëœ ê³„ì • ê´€ë¦¬ëŠ” <strong>ë§ˆì´í˜ì´ì§€</strong>ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        <p class="text-gray-500">ğŸ”’ ë³´ì•ˆìƒ ê³„ì • í•´ì œê°€ í•„ìš”í•  ê²½ìš° <strong>ê³ ê°ì„¼í„°</strong>ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</p>
                    </div>
                `;
            } else if (type === 'JUST_LOGIN') {
                 title.innerText = "ë¡œê·¸ì¸ ì„±ê³µ";
                 desc.innerHTML = `ë°˜ê°‘ìŠµë‹ˆë‹¤ ì‚¬ì¥ë‹˜!<br>í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`;
            } else if (type === 'EXISTING') {
                title.innerText = "í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.";
                desc.innerHTML = `ë°˜ê°‘ìŠµë‹ˆë‹¤ ì‚¬ì¥ë‹˜!<br><span class="text-[#14682A] font-bold">ìš”ì²­í•˜ì‹  í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.</span>`;
            } else {
                title.innerText = "ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!";
                desc.innerHTML = `ë§¤ì¹­ ë° ë“±ë¡ ì™„ë£Œ.<br><span class="text-[#14682A] font-bold">ìƒí’ˆ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.</span>`;
            }
            
            toast.classList.add('show');
            setTimeout(() => { bar.style.width = "100%"; }, 100);
            setTimeout(() => { loadingArea.classList.add('hidden'); btnArea.classList.remove('hidden'); }, 1600);
        }

        function goToNextPage() {
            const nextUrl = document.getElementById('next_url').value;
            alert(`[ì‹œìŠ¤í…œ ì´ë™] ${nextUrl} ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
            window.location.reload(); 
        }

        function handleCompanyKeydown(event) { if (event.key === 'Enter') { event.preventDefault(); const addrInput = document.getElementById('mb_addr1'); addrInput.scrollIntoView({ behavior: 'smooth', block: 'center' }); } }
        function openDaumPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    var addr = data.userSelectedType === 'R' ? data.roadAddress : data.jibunAddress;
                    if(data.userSelectedType === 'J' && !addr){ addr = data.autoJibunAddress; }
                    var extraAddr = '';
                    if(data.userSelectedType === 'R'){ if(data.bname !== '' && /[ë™|ë¡œ|ê°€]$/g.test(data.bname)){ extraAddr += data.bname; } if(data.buildingName !== '' && data.apartment === 'Y'){ extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName); } if(extraAddr !== ''){ extraAddr = ' (' + extraAddr + ')'; } }
                    if(document.getElementById('mb_zip')) { document.getElementById('mb_zip').value = data.zonecode; }
                    const addrInput = document.getElementById('mb_addr1');
                    if(addrInput) { addrInput.value = addr; addrInput.classList.add('text-gray-900', 'font-medium'); }
                    if(document.getElementById('mb_addr3')) { document.getElementById('mb_addr3').value = extraAddr; }
                    if(document.getElementById('mb_addr2')) { document.getElementById('mb_addr2').focus(); }
                }
            }).open();
        }
        function autoHyphen(target) { target.value = target.value.replace(/[^0-9]/g, '').replace(/^(\d{0,3})(\d{0,4})(\d{0,4})$/g, "$1-$2-$3").replace(/(\-{1,2})$/g, ""); }
    </script>
</body>
</html>
